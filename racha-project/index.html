<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Racha Map - Final Stable UI</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css' type='text/css' />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <style>
        @import url('https://fonts.cdnfonts.com/css/sf-pro-display');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@100..900&display=swap');

        :root {
            --glass: rgba(10, 10, 10, 0.45) !important; 
            --border: rgba(255, 255, 255, 0.18) !important;
            --apple-green: rgba(52, 199, 89, 0.4) !important;
        }

        .light-mode-active { 
            --glass: rgba(255, 255, 255, 0.2) !important; 
            --border: rgba(255, 255, 255, 0.3) !important; 
        }

        body { margin: 0; padding: 0; font-family: "Noto Sans Georgian", sans-serif; background: #000; overflow: hidden; color: #fff; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }
        .mapboxgl-ctrl-bottom-left, .mapboxgl-ctrl-bottom-right { display: none !important; }

        /* --- üõë ·É´·Éò·Éî·Éë·Éò·É° Glass ·É§·Éò·É•·É°·Éò (Immutable) --- */
        .mapboxgl-ctrl-geocoder, .mapboxgl-ctrl-geocoder--input, .suggestions {
            background: var(--glass) !important;
            backdrop-filter: blur(30px) !important;
            color: #fff !important;
            border: 0.5px solid var(--border) !important;
            box-shadow: none !important;
        }
        .mapboxgl-ctrl-geocoder--icon-search { left: 10px !important; top: 50% !important; transform: translateY(-50%) !important; fill: #fff !important; width: 14px !important; opacity: 1 !important; }
        .mapboxgl-ctrl-geocoder--button { background: none !important; top: 50% !important; transform: translateY(-50%) !important; right: 5px !important; }
        .mapboxgl-ctrl-geocoder--icon-close { fill: #fff !important; width: 12px !important; }

        /* --- UI Elements --- */
        .main-bar { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 25; display: flex; align-items: center; gap: 15px; background: var(--glass); backdrop-filter: blur(40px); padding: 4px 20px; border-radius: 100px; border: 0.5px solid var(--border); width: 90%; max-width: 600px; height: 28px; justify-content: space-between; }
        .side-controls, .right-controls { position: absolute; top: 20px; z-index: 20; display: flex; flex-direction: column; gap: 10px; }
        .side-controls { left: 15px; } .right-controls { right: 15px; }

        @media (max-width: 768px) { .side-controls, .right-controls { top: 75px; } .nav-links { display: none; } }

        .btn-circle { width: 36px; height: 36px; border-radius: 50%; background: var(--glass); backdrop-filter: blur(25px); border: 0.5px solid var(--border); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-circle.active { background: var(--apple-green) !important; }

        /* --- Auth Modal --- */
        #authModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 290px; z-index: 100; display: none; flex-direction: column; gap: 16px; }
        .close-btn { position: absolute; top: -50px; left: 50%; transform: translateX(-50%); cursor: pointer; color: #fff; }
        .modal-input, .modal-btn { background: var(--glass) !important; backdrop-filter: blur(30px) !important; border: 0.5px solid var(--border) !important; border-radius: 100px; padding: 12px 20px; color: #fff !important; outline: none; font-size: 12px; }
        
        .material-symbols-outlined { font-variation-settings: 'wght' 200; font-size: 18px; color: #fff !important; }
    </style>
</head>
<body id="mainBody">

    <div id="map"></div>

    <div class="side-controls">
        <button class="btn-circle" onclick="window.toggleTheme()"><span class="material-symbols-outlined" id="themeIcon">light_mode</span></button>
        <div class="weather-container">
            <button class="btn-circle"><span id="btnTemp" style="font-size: 11px; font-weight: 700; color:#fff;">--¬∞</span></button>
            <div id="weatherWidget" style="position:absolute; left:45px; top:0; background:var(--glass); backdrop-filter:blur(30px); padding:10px; border-radius:15px; border:0.5px solid var(--border); display:none;">
                <span id="widgetTemp">--¬∞C</span> <span class="material-symbols-outlined" style="color:#ffcc00 !important;">wb_sunny</span>
            </div>
        </div>
        <button class="btn-circle" onclick="window.zoomMap('in')"><span class="material-symbols-outlined">add</span></button>
        <button class="btn-circle" onclick="window.zoomMap('out')"><span class="material-symbols-outlined">remove</span></button>
    </div>

    <div class="main-bar">
        <div id="geocoder-box"></div>
        <div class="nav-links" style="font-size:10px; display:flex; gap:10px;">
            <span id="nav-all">·Éß·Éï·Éî·Éö·Éê</span>
            <span id="nav-hotels">·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·Éî·Éë·Éò</span>
        </div>
    </div>

    <div class="right-controls">
        <button class="btn-circle" onclick="window.toggleAuth()"><span class="material-symbols-outlined">person</span></button>
        <button class="btn-circle" id="langBtn" onclick="window.toggleLanguage()" style="font-size:10px; font-weight:700;">GE</button>
    </div>

    <div id="authModal">
        <div class="close-btn" onclick="window.toggleAuth()"><span class="material-symbols-outlined" style="font-size: 26px;">close</span></div>
        <input type="email" id="email" class="modal-input" placeholder="·Éî·Éö-·É§·Éù·É°·É¢·Éê">
        <input type="password" id="password" class="modal-input" placeholder="·Éû·Éê·É†·Éù·Éö·Éò">
        <button class="modal-btn" onclick="window.handleAuth()">Login</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyAJbHfM7kT614kX9DBegyMQn1zALl6m23c", authDomain: "racha-map.firebaseapp.com", projectId: "racha-map", storageBucket: "racha-map.firebasestorage.app", messagingSenderId: "240476452622", appId: "1:240476452622:web:c63b9a525740e235b3095f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // üõë ·É§·É£·Éú·É•·É™·Éò·Éî·Éë·Éò·É° ·Éõ·Éò·Éë·Éõ·Éê Window-·Éñ·Éî, ·É†·Éù·Éõ ·Éê·É†·Éê·É°·Éì·É†·Éù·É° ·Éí·Éê·Éò·Éó·Éò·É®·Éù·É°
        window.toggleTheme = () => {
            document.getElementById('mainBody').classList.toggle('light-mode-active');
            const icon = document.getElementById('themeIcon');
            icon.innerText = icon.innerText === 'light_mode' ? 'dark_mode' : 'light_mode';
        };

        window.toggleAuth = () => { const m = document.getElementById('authModal'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; };
        window.zoomMap = (dir) => { dir === 'in' ? map.zoomIn() : map.zoomOut(); };

        mapboxgl.accessToken = 'pk.eyJ1Ijoic2FidWthNjI5IiwiYSI6ImNtbHBza2JqcDFjZ2EzZ3F4YjVuN3EwMmoifQ.V6q1KO4tol7QefPr8PQFxQ';
        const map = new mapboxgl.Map({ container: 'map', style: 'mapbox://styles/mapbox/satellite-streets-v12', center: [43.1481, 42.5176], zoom: 11, pitch: 60 });

        map.on('style.load', () => {
            map.getStyle().layers.forEach(l => { if (l.type === 'symbol' && l.id.includes('shield')) map.setLayoutProperty(l.id, 'visibility', 'none'); });
            if (!map.getSource('mapbox-dem')) { map.addSource('mapbox-dem', { 'type': 'raster-dem', 'url': 'mapbox://mapbox.mapbox-terrain-dem-v1', 'tileSize': 512 }); map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.6 }); }
        });

        const geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken, mapboxgl: mapboxgl, placeholder: '·É´·Éî·Éë·Éú·Éê...', marker: false });
        document.getElementById('geocoder-box').appendChild(geocoder.onAdd(map));
    </script>
</body>
</html>
