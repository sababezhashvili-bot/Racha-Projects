<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Racha Map - Minimalist Pro</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css' type='text/css' />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />

    <style>
        @import url('https://fonts.cdnfonts.com/css/sf-pro-display');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@100..900&display=swap');

        :root {
            --glass: rgba(10, 10, 10, 0.4); 
            --border: rgba(255, 255, 255, 0.12);
            --text: #ffffff;
            --apple-green: rgba(52, 199, 89, 0.35);
        }

        body { margin: 0; padding: 0; font-family: "Noto Sans Georgian", sans-serif; background: #000; overflow: hidden; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }
        .mapboxgl-ctrl-bottom-left, .mapboxgl-ctrl-bottom-right { display: none !important; }

        /* --- UI Controls --- */
        .side-controls, .right-controls { position: absolute; top: 20px; z-index: 10; display: flex; flex-direction: column; gap: 10px; }
        .side-controls { left: 15px; }
        .right-controls { right: 15px; }
        .btn-circle { width: 36px; height: 36px; border-radius: 50%; background: var(--glass); backdrop-filter: blur(25px); border: 0.5px solid var(--border); color: var(--text); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .btn-circle.active { background: var(--apple-green) !important; border-color: rgba(52, 199, 89, 0.5); }

        /* --- Layers --- */
        .layer-group { position: relative; display: flex; align-items: center; }
        .sub-layers { position: absolute; left: 42px; display: flex; gap: 6px; opacity: 0; visibility: hidden; transition: 0.4s; }
        .layer-group:hover .sub-layers { opacity: 1; visibility: visible; left: 48px; }

        /* --- Main Bar --- */
        .main-bar { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; align-items: center; gap: 15px; background: var(--glass); backdrop-filter: blur(40px); padding: 5px 15px; border-radius: 100px; border: 0.5px solid var(--border); color: var(--text); }
        .nav-links { display: flex; gap: 10px; font-size: 10px; font-weight: 600; opacity: 0.8; }

        /* --- Auth Modal --- */
        #authModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 280px; padding: 40px 30px 30px 30px; border-radius: 28px; background: rgba(20, 20, 20, 0.75); backdrop-filter: blur(60px); border: 0.5px solid var(--border); z-index: 100; display: none; flex-direction: column; gap: 18px; color: #fff; }
        
        /* üõë ·Éê·Éú·Éò·Éõ·Éò·É†·Éî·Éë·É£·Éö·Éò X (·Éõ·ÉÆ·Éù·Éö·Éù·Éì Scale) */
        .close-btn { position: absolute; top: 15px; right: 15px; cursor: pointer; color: rgba(255,255,255,0.5); transition: 0.2s ease; }
        .close-btn:hover { transform: scale(1.15); color: #fff; } 
        
        .modal-input { background: rgba(255,255,255,0.06) !important; border: 0.5px solid var(--border) !important; border-radius: 12px; padding: 12px; color: #fff !important; outline: none; font-size: 13px; }
        .modal-btn { background: var(--apple-green) !important; color: #fff !important; border: 0.5px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .modal-btn:hover { background: rgba(52, 199, 89, 0.5) !important; transform: translateY(-1px); }

        .mapboxgl-ctrl-geocoder { background: rgba(255,255,255,0.08) !important; border-radius: 100px !important; width: 140px !important; height: 28px !important; display: flex !important; align-items: center !important; }
        .mapboxgl-ctrl-geocoder--input { color: #fff !important; padding: 0 30px !important; height: 28px !important; font-size: 10px !important; }
        .material-symbols-outlined { font-variation-settings: 'wght' 200; font-size: 18px; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="side-controls">
        <button class="btn-circle" onclick="toggleTheme()"><span class="material-symbols-outlined" id="themeIcon">light_mode</span></button>
        <div class="layer-group">
            <button class="btn-circle" id="masterLayerBtn" onclick="toggleAllLayers(this)"><span class="material-symbols-outlined">layers</span></button>
            <div class="sub-layers">
                <button class="btn-circle" id="btn-admin" onclick="toggleSingleLayer('admin', this)"><span class="material-symbols-outlined">map</span></button>
                <button class="btn-circle active" id="btn-place" onclick="toggleSingleLayer('place', this)"><span class="material-symbols-outlined">home</span></button>
                <button class="btn-circle" id="btn-3d" onclick="toggleSingleLayer('3d-buildings', this)"><span class="material-symbols-outlined">apartment</span></button>
            </div>
        </div>
        <button class="btn-circle" onclick="map.zoomIn()"><span class="material-symbols-outlined">add</span></button>
        <button class="btn-circle" onclick="map.zoomOut()"><span class="material-symbols-outlined">remove</span></button>
    </div>

    <div class="main-bar">
        <div style="display:flex; align-items:center; gap:6px; font-size:10px;">
            Loc <label style="position:relative; display:inline-block; width:28px; height:14px;">
                <input type="checkbox" onchange="getUserLoc(this)" style="opacity:0; width:0; height:0;"><span style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:rgba(255,255,255,0.1); border-radius:34px; transition:.4s;"></span>
                <span id="slider-dot" style="position:absolute; height:10px; width:10px; left:2px; bottom:2px; background:white; border-radius:50%; transition:.4s;"></span>
            </label>
        </div>
        <div id="geocoder-box"></div>
        <div class="nav-links">
            <span id="nav-all">·Éß·Éï·Éî·Éö·Éê</span>
            <span id="nav-hotels">·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·Éî·Éë·Éò</span>
        </div>
    </div>

    <div class="right-controls">
        <button class="btn-circle" onclick="toggleAuth()"><span class="material-symbols-outlined">person</span></button>
        <button class="btn-circle" id="langBtn" onclick="toggleLanguage()" style="font-size: 10px; font-weight: 700;">GE</button>
    </div>

    <div id="authModal">
        <div class="close-btn" onclick="toggleAuth()"><span class="material-symbols-outlined" style="font-size: 22px;">close</span></div>
        <h3 id="authTitle" style="margin:0; font-size: 18px; text-align: center; font-weight: 400;">·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó</h3>
        <input type="email" id="email" class="modal-input" placeholder="·Éî·Éö-·É§·Éù·É°·É¢·Éê" autocomplete="off">
        <input type="password" id="password" class="modal-input" placeholder="·Éû·Éê·É†·Éù·Éö·Éò" autocomplete="off">
        <button class="modal-btn" onclick="handleAuth()">Login</button>
        <p style="font-size: 9px; opacity: 0.5; text-align: center; cursor: pointer;" onclick="switchAuth()">·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJbHfM7kT614kX9DBegyMQn1zALl6m23c",
            authDomain: "racha-map.firebaseapp.com",
            projectId: "racha-map",
            storageBucket: "racha-map.firebasestorage.app",
            messagingSenderId: "240476452622",
            appId: "1:240476452622:web:c63b9a525740e235b3095f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        let currentLang = 'ka';

        window.toggleAuth = () => { const m = document.getElementById('authModal'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; };
        window.switchAuth = () => { document.getElementById('authTitle').innerText = document.getElementById('authTitle').innerText === '·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó' ? '·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê' : '·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó'; };
        window.handleAuth = async () => {
            const e = document.getElementById('email').value, p = document.getElementById('password').value;
            try { await signInWithEmailAndPassword(auth, e, p); alert("·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó!"); toggleAuth(); } catch (err) { alert("·É®·Éî·É™·Éì·Éù·Éõ·Éê·Éê!"); }
        };

        mapboxgl.accessToken = 'pk.eyJ1Ijoic2FidWthNjI5IiwiYSI6ImNtbHBza2JqcDFjZ2EzZ3F4YjVuN3EwMmoifQ.V6q1KO4tol7QefPr8PQFxQ';
        const map = new mapboxgl.Map({ container: 'map', style: 'mapbox://styles/mapbox/satellite-streets-v12', center: [43.1481, 42.5176], zoom: 11, pitch: 60 });

        map.on('style.load', () => {
            const layers = map.getStyle().layers;
            layers.forEach(l => { if (l.type === 'symbol' && l.id.includes('shield')) map.setLayoutProperty(l.id, 'visibility', 'none'); });
            if (!map.getSource('mapbox-dem')) {
                map.addSource('mapbox-dem', { 'type': 'raster-dem', 'url': 'mapbox://mapbox.mapbox-terrain-dem-v1', 'tileSize': 512 });
                map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.6 });
            }
            updateMapLang();
        });

        const geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken, mapboxgl: mapboxgl, placeholder: '·É´·Éî·Éë·Éú·Éê...', marker: false });
        document.getElementById('geocoder-box').appendChild(geocoder.onAdd(map));

        window.toggleTheme = () => { document.body.classList.toggle('light-mode-active'); };
        
        // üåç ·Éî·Éú·Éò·É° ·É°·É†·É£·Éö·Éò ·Éö·Éù·Éí·Éò·Éô·Éê
        window.toggleLanguage = () => { 
            currentLang = currentLang === 'ka' ? 'en' : 'ka';
            document.getElementById('langBtn').innerText = currentLang === 'ka' ? 'GE' : 'EN';
            document.getElementById('nav-all').innerText = currentLang === 'ka' ? '·Éß·Éï·Éî·Éö·Éê' : 'ALL';
            document.getElementById('nav-hotels').innerText = currentLang === 'ka' ? '·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·Éî·Éë·Éò' : 'HOTELS';
            updateMapLang();
        };

        function updateMapLang() {
            map.getStyle().layers.forEach(l => {
                if (l.layout && l.layout['text-field']) {
                    map.setLayoutProperty(l.id, 'text-field', ['coalesce', ['get', 'name_' + currentLang], ['get', 'name_en'], ['get', 'name']]);
                }
            });
        }

        window.toggleAllLayers = (btn) => {
            const act = btn.classList.toggle('active');
            ['admin', 'place', '3d-buildings'].forEach(t => {
                const sub = document.getElementById(t === 'admin' ? 'btn-admin' : t === 'place' ? 'btn-place' : 'btn-3d');
                if (sub) sub.classList[act ? 'add' : 'remove']('active');
                applyVis(t, act ? 'visible' : 'none');
            });
        };
        window.toggleSingleLayer = (t, b) => { applyVis(t, b.classList.toggle('active') ? 'visible' : 'none'); };
        function applyVis(t, v) { map.getStyle().layers.forEach(l => { if ((t==='place' && l.id.includes('settlement')) || (t==='admin' && l.id.includes('admin')) || (t==='3d-buildings' && l.id==='3d-buildings')) map.setLayoutProperty(l.id, 'visibility', v); }); }

        window.getUserLoc = (el) => { if (el.checked) { document.getElementById('slider-dot').style.transform = "translateX(14px)"; navigator.geolocation.getCurrentPosition(p => map.flyTo({ center: [p.coords.longitude, p.coords.latitude], zoom: 15 })); } else document.getElementById('slider-dot').style.transform = "translateX(0)"; };
    </script>
</body>
</html>
